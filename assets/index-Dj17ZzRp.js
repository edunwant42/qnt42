import{initializeApp as l}from"https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";import{getAuth as g,onAuthStateChanged as f}from"https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";import{getDatabase as h,ref as m,get as p,child as y}from"https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function c(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=c(t);fetch(t.href,o)}})();const L={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""},u=l(L),O=g(u),b=h(u),w=m(b),n={PUBLIC:"public",AUTH_ONLY:"auth-only",GUEST_ONLY:"guest-only"},a={DASHBOARD:"/src/pages/dashboard.html",LOGIN:"/src/pages/auth/login.html",REGISTER:"/src/pages/auth/register.html",HOME:"/"};function S(){const e=window.location.pathname.toLowerCase();return e.includes("dashboard.html")||e.includes("/src/pages/dashboard.html")?n.AUTH_ONLY:e.includes("/auth/login.html")||e.includes("/auth/register.html")||e.includes("login.html")&&e.includes("auth")||e.includes("register.html")&&e.includes("auth")||e==="/"||e.includes("index.html")?n.GUEST_ONLY:n.PUBLIC}function d(e){if(!e)return;const i=typeof e=="string"&&a[e.toUpperCase()];window.location.href=i||e}function A(){const e=S();document.body.classList.add("loading"),f(O,async i=>{if(window.isRegistering||window.isLoggingOut){document.body.classList.remove("loading"),window.isLoggingOut&&(window.isLoggingOut=!1);return}switch(e){case n.AUTH_ONLY:if(i){if(!localStorage.getItem("user-info"))try{const s=await p(y(w,"users/"+i.uid));if(s.exists()){const t=s.val();localStorage.setItem("user-info",JSON.stringify({username:t.username||"!F",secretKey:t.secretKey||"!F"}))}}catch(s){console.error("Auth guard: failed to fetch user data",s)}}else{sessionStorage.setItem("info","Info: You must be logged in to access the desired page."),console.log("Redirecting unauthenticated user to login."),d(a.LOGIN);return}break;case n.GUEST_ONLY:if(i){console.log("Redirecting authenticated user to dashboard."),d(a.DASHBOARD);return}break}document.body.classList.remove("loading")})}document.addEventListener("DOMContentLoaded",A);
